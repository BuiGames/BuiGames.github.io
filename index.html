<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bui Project - The Adventure</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Roboto:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #1a1a1a;
            color: #fff;
            font-family: 'Press Start 2P', cursive;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            flex-direction: column;
        }

        .game-container {
            border: 8px solid #444;
            border-radius: 15px;
            background-color: #000;
            padding: 20px;
            box-shadow: 0 0 25px #ff00ff, 0 0 15px #00ffff inset;
            position: relative;
        }

        canvas {
            background-color: #0d0d0d;
            display: block;
            border-radius: 5px;
            border: 2px solid #333;
            cursor: pointer;
        }

        .message-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        .final-message {
            font-size: 2rem;
            color: #00ff00;
            line-height: 1.6;
            text-shadow: 2px 2px 0px #1a1a1a;
            max-width: 90%;
        }

        .cta-button {
            display: inline-block;
            background-color: #ffff00;
            color: #1a1a1a;
            padding: 20px 40px;
            margin-top: 30px;
            border-radius: 5px;
            text-decoration: none;
            font-size: 1.5rem;
            text-shadow: none;
            border: 3px solid #1a1a1a;
            box-shadow: 5px 5px 0px #ff00ff;
            transition: all 0.1s linear;
        }

        .cta-button:hover {
            transform: translate(2px, 2px);
            box-shadow: 3px 3px 0px #ff00ff;
        }
        .cta-button:active {
            transform: translate(5px, 5px);
            box-shadow: 0 0 0 #ff00ff;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body>

    <div class="game-container">
        <canvas id="gameCanvas" width="1200" height="800"></canvas>
        <div id="messageOverlay" class="message-overlay">
            <div id="messageText" class="final-message"></div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const messageOverlay = document.getElementById('messageOverlay');
        const messageText = document.getElementById('messageText');

        // --- Game State ---
        let gameState = 'CHOOSE_PRODUCT';
        let userChoices = {
            product: null,
            manufacturer: null,
        };
        let hoverTarget = null;
        let animationState = { x: 0, alpha: 0, complete: false, lootboxItemIndex: 0, frame: 0 };
        let rainbowHue = 0;

        // --- Clickable Regions ---
        let clickRegions = {};

        function setRegions(regions) {
            clickRegions[gameState] = regions;
        }

        // --- Drawing Assets ---
        function drawIdealHat(x, y, scale = 1) {
            ctx.save();
            ctx.translate(x, y);
            ctx.scale(scale, scale);
            ctx.fillStyle = '#ff1493'; // Deep Pink
            ctx.beginPath();
            ctx.ellipse(100, 100, 100, 25, 0, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = '#ff69b4'; // Hot Pink
            ctx.beginPath();
            ctx.ellipse(100, 70, 60, 40, 0, 0, Math.PI * 2);
            ctx.fill();
            ctx.restore();
        }

        function drawIdealPants(x, y, scale = 1) {
            ctx.save();
            ctx.translate(x, y);
            ctx.scale(scale, scale);
            ctx.fillStyle = '#1e90ff'; // Dodger Blue
            ctx.fillRect(50, 0, 50, 150);
            ctx.fillRect(110, 0, 50, 150);
            ctx.fillRect(50, -10, 110, 20);
            ctx.restore();
        }

        function drawIdealTop(x, y, scale = 1) {
            ctx.save();
            ctx.translate(x, y);
            ctx.scale(scale, scale);
            ctx.fillStyle = '#32cd32'; // Lime Green
            ctx.beginPath();
            ctx.moveTo(50, 0);
            ctx.lineTo(150, 0);
            ctx.lineTo(120, 150);
            ctx.lineTo(80, 150);
            ctx.closePath();
            ctx.fill();
            ctx.restore();
        }
        
        const idealProducts = {
            hat: { draw: drawIdealHat, name: "A Fabulous Hat" },
            pants: { draw: drawIdealPants, name: "Trendy Pants" },
            top: { draw: drawIdealTop, name: "A Cute Top" },
        };
        
        function drawFlawedItem(item, x, y, scale = 1){
            // Simplified flawed item drawing
             ctx.save();
             ctx.translate(x, y);
             ctx.scale(scale, scale);
             ctx.globalAlpha = 0.6;
             ctx.filter = 'grayscale(80%)';
             idealProducts[item].draw(0,0);
             ctx.filter = 'none';
             ctx.globalAlpha = 1;

            // Draw a big red X
            ctx.strokeStyle = '#ff0000';
            ctx.lineWidth = 15;
            ctx.beginPath();
            ctx.moveTo(50, 20);
            ctx.lineTo(150, 130);
            ctx.moveTo(150, 20);
            ctx.lineTo(50, 130);
            ctx.stroke();

            ctx.restore();
        }

        function drawManufacturer(x, y, type) {
            ctx.fillStyle = '#F5DEB3'; // Wheat
            ctx.beginPath();
            ctx.arc(x, y, 50, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = '#000';
            ctx.beginPath();
            ctx.arc(x - 20, y - 10, 5, 0, Math.PI * 2);
            ctx.arc(x + 20, y - 10, 5, 0, Math.PI * 2);
            ctx.fill();

            ctx.beginPath();
            ctx.moveTo(x - 20, y + 20);
            ctx.lineTo(x + 20, y + 20);
            ctx.stroke();

            ctx.font = '16px "Press Start 2P"';
            ctx.textAlign = 'center';
            ctx.fillStyle = '#fff';
            ctx.fillText(type, x, y + 80);
        }
        
        function drawBuiManufacturer(x, y) {
            // Head
            ctx.fillStyle = '#F5DEB3';
            ctx.beginPath();
            ctx.arc(x, y, 60, 0, Math.PI * 2);
            ctx.fill();

            // Eyes (cool sunglasses)
            ctx.fillStyle = '#000';
            ctx.fillRect(x - 40, y - 20, 30, 15);
            ctx.fillRect(x + 10, y - 20, 30, 15);
            ctx.fillRect(x-10, y-15, 20, 5);

            // Smile
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(x, y + 20, 20, 0, Math.PI);
            ctx.stroke();
            
            // Tattoos (simple swirls)
            ctx.strokeStyle = '#555';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(x - 40, y + 10);
            ctx.quadraticCurveTo(x-60, y+30, x-40, y+50);
            ctx.stroke();

            // Flag
            ctx.fillStyle = '#ff0000';
            ctx.fillRect(x + 70, y - 50, 100, 60);
            ctx.fillStyle = '#ffff00';
            ctx.beginPath();
            ctx.moveTo(x + 120, y - 40);
            ctx.lineTo(x + 130, y - 20);
            ctx.lineTo(x + 150, y - 20);
            ctx.lineTo(x + 135, y - 10);
            ctx.lineTo(x + 140, y + 5);
            ctx.lineTo(x + 120, y - 5);
            ctx.lineTo(x + 100, y + 5);
            ctx.lineTo(x + 105, y - 10);
            ctx.lineTo(x + 90, y - 20);
            ctx.lineTo(x + 110, y - 20);
            ctx.closePath();
            ctx.fill();

             ctx.font = '16px "Press Start 2P"';
             ctx.textAlign = 'center';
             ctx.fillStyle = '#fff';
             ctx.fillText("Bui Project", x, y + 100);
        }

        function drawText(text, x, y, size = 32, color = '#fff') {
            ctx.font = `${size}px "Press Start 2P"`;
            ctx.fillStyle = color;
            ctx.textAlign = 'center';
            ctx.fillText(text, x, y);
        }
        
        function drawButton(text, x, y, w, h, isHovered = false) {
            ctx.fillStyle = isHovered ? '#ffff00' : '#fff';
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 3;
            ctx.strokeRect(x,y,w,h);
            drawText(text, x + w/2, y + h/2 + 8, 20, isHovered ? '#000' : '#fff');
        }

        // --- Game Screens ---

        function drawChooseProductScreen() {
            drawText("First, choose your creation:", canvas.width / 2, 100);
            
            const regions = [
                { id: 'hat', x: 150, y: 300, w: 200, h: 200 },
                { id: 'pants', x: 500, y: 300, w: 200, h: 200 },
                { id: 'top', x: 850, y: 300, w: 200, h: 200 },
            ];

            regions.forEach(region => {
                ctx.strokeStyle = (hoverTarget === region.id) ? '#ffff00' : '#555';
                ctx.lineWidth = 4;
                ctx.strokeRect(region.x - 20, region.y - 20, region.w + 40, region.h + 40);
                idealProducts[region.id].draw(region.x, region.y);
                drawText(idealProducts[region.id].name, region.x + region.w / 2, region.y + 250, 16);
            });
            setRegions(regions);
        }

        function drawManufacturerScreen() {
            drawText("Next, choose your manufacturer:", canvas.width / 2, 100);

            const regions = [
                { id: 'china', x: 250, y: 400, w: 100, h: 100 },
                { id: 'portugal', x: 600, y: 400, w: 100, h: 100 },
                { id: 'germany', x: 950, y: 400, w: 100, h: 100 },
            ];

            drawManufacturer(regions[0].x, regions[0].y, "China");
            drawManufacturer(regions[1].x, regions[1].y, "Portugal");
            drawManufacturer(regions[2].x, regions[2].y, "Germany");
            
            if(hoverTarget === 'china') drawText('$', regions[0].x, regions[0].y + 130, 30, '#00ff00');
            if(hoverTarget === 'portugal') drawText('$$', regions[1].x, regions[1].y + 130, 30, '#00ff00');
            if(hoverTarget === 'germany') drawText('$$$', regions[2].x, regions[2].y + 130, 30, '#00ff00');
            setRegions(regions);
        }
        
        function drawShippingScreen() {
            drawText("Shipping your sample...", canvas.width/2, 100);
            
            if (userChoices.manufacturer === 'germany') { // Truck
                ctx.fillStyle = '#ffff00';
                ctx.fillRect(animationState.x, canvas.height/2, 100, 50); // Body
                ctx.fillRect(animationState.x + 100, canvas.height/2 + 20, 40, 30); // Cab
                ctx.fillStyle = '#555';
                ctx.beginPath();
                ctx.arc(animationState.x + 20, canvas.height/2 + 50, 15, 0, Math.PI * 2);
                ctx.arc(animationState.x + 90, canvas.height/2 + 50, 15, 0, Math.PI * 2);
                ctx.fill();
            } else { // Boat
                ctx.fillStyle = '#8B4513';
                ctx.beginPath();
                ctx.moveTo(animationState.x, canvas.height/2);
                ctx.lineTo(animationState.x + 200, canvas.height/2);
                ctx.lineTo(animationState.x + 170, canvas.height/2 + 50);
                ctx.lineTo(animationState.x + 30, canvas.height/2 + 50);
                ctx.closePath();
                ctx.fill();
                ctx.fillStyle = '#fff';
                ctx.fillRect(animationState.x + 40, canvas.height/2 - 30, 120, 30);
            }
            // Animate
            animationState.x += 5;
            if (animationState.x > canvas.width) {
                 gameState = 'REVEAL_FLAWED';
                 resetAnimation();
            }
        }
        
        function drawRevealFlawedScreen() {
            drawText("Oh no... it's not quite right.", canvas.width/2, 150, 30, '#ff4d4d');
            drawFlawedItem(userChoices.product, canvas.width/2 - 100, 250);
            
            const region = { id: 'restart', x: canvas.width/2 - 150, y: 600, w: 300, h: 80 };
            drawButton("Restart?", region.x, region.y, region.w, region.h, hoverTarget === region.id);
            setRegions([region]);
        }
        
        function drawRestartScreen() {
             drawText("There must be a better way...", canvas.width/2, 200);
             const region = { id: 'bui', x: canvas.width/2 - 250, y: 350, w: 500, h: 120 };
             
             // Rainbow button
             ctx.fillStyle = `hsl(${rainbowHue}, 100%, 60%)`;
             ctx.strokeStyle = '#fff';
             ctx.lineWidth = 5;
             ctx.fillRect(region.x, region.y, region.w, region.h);
             ctx.strokeRect(region.x, region.y, region.w, region.h);
             drawText("TRY BUI PROJECT", region.x + region.w/2, region.y + region.h/2 + 10, 30, '#fff');
             
             setRegions([region]);
        }
        
        function drawBuiExperience() {
            animationState.frame++;
            if (animationState.frame % 30 === 0) {
                 animationState.lootboxItemIndex = (animationState.lootboxItemIndex + 1) % Object.keys(idealProducts).length;
            }
            
            // Draw Lootbox
            ctx.fillStyle = `hsl(${rainbowHue}, 100%, 50%)`;
            ctx.strokeStyle = `hsl(${rainbowHue}, 100%, 80%)`;
            ctx.fillRect(canvas.width / 2 - 150, 100, 300, 250);
            ctx.strokeRect(canvas.width / 2 - 150, 100, 300, 250);

            // Draw cycling item
            const itemKey = Object.keys(idealProducts)[animationState.lootboxItemIndex];
            idealProducts[itemKey].draw(canvas.width/2 - 100, 150);

            drawBuiManufacturer(canvas.width/2, 550);

            if(animationState.alpha < 1) animationState.alpha += 0.02;
            
            ctx.globalAlpha = animationState.alpha;
            drawText("We can make anything.", canvas.width/2, 400, 20);
            drawText("Flexible Pricing. Quality Guaranteed.", canvas.width/2, 700, 20);
            ctx.globalAlpha = 1;
        }
        
        function drawRevealPerfectScreen() {
            drawText("The perfect item has arrived!", canvas.width / 2, 200, 30, '#00ff00');
            idealProducts[userChoices.product].draw(canvas.width / 2 - 100, 300, 1.5);
        }

        // --- Main Loop ---
        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            hoverTarget = null;
            rainbowHue = (rainbowHue + 2) % 360;

            switch (gameState) {
                case 'CHOOSE_PRODUCT':
                    drawChooseProductScreen();
                    break;
                case 'CHOOSE_MANUFACTURER':
                    drawManufacturerScreen();
                    break;
                case 'SHIPPING_ANIMATION':
                    drawShippingScreen();
                    break;
                case 'REVEAL_FLAWED':
                    drawRevealFlawedScreen();
                    break;
                case 'RESTART_SCREEN':
                    drawRestartScreen();
                    break;
                case 'BUI_EXPERIENCE':
                     drawBuiExperience();
                     break;
                case 'REVEAL_PERFECT':
                     drawRevealPerfectScreen();
                     break;
            }

            requestAnimationFrame(gameLoop);
        }
        
        function resetAnimation() {
            animationState = { x: -200, alpha: 0, complete: false, lootboxItemIndex: 0, frame: 0 };
        }

        // --- Event Handlers ---
        function handleMouseMove(event) {
            const rect = canvas.getBoundingClientRect();
            const mouseX = event.clientX - rect.left;
            const mouseY = event.clientY - rect.top;
            
            const regions = clickRegions[gameState] || [];
            let foundHover = false;
            for (const region of regions) {
                 if (mouseX >= region.x && mouseX <= region.x + region.w &&
                     mouseY >= region.y && mouseY <= region.y + region.h) {
                     hoverTarget = region.id;
                     canvas.style.cursor = 'pointer';
                     foundHover = true;
                     break;
                 }
            }
            if(!foundHover) canvas.style.cursor = 'default';
        }

        function handleClick(event) {
            const rect = canvas.getBoundingClientRect();
            const mouseX = event.clientX - rect.left;
            const mouseY = event.clientY - rect.top;

            const regions = clickRegions[gameState] || [];
            for (const region of regions) {
                if (mouseX >= region.x && mouseX <= region.x + region.w &&
                    mouseY >= region.y && mouseY <= region.y + region.h) {
                    
                    // --- State Transitions based on Clicks ---
                    switch(gameState) {
                        case 'CHOOSE_PRODUCT':
                            userChoices.product = region.id;
                            gameState = 'CHOOSE_MANUFACTURER';
                            break;
                        case 'CHOOSE_MANUFACTURER':
                             userChoices.manufacturer = region.id;
                             gameState = 'SHIPPING_ANIMATION';
                             resetAnimation();
                             break;
                        case 'REVEAL_FLAWED':
                            if (region.id === 'restart') {
                                gameState = 'RESTART_SCREEN';
                            }
                            break;
                        case 'RESTART_SCREEN':
                            if (region.id === 'bui') {
                                gameState = 'BUI_EXPERIENCE';
                                resetAnimation();
                                setTimeout(() => {
                                    gameState = 'REVEAL_PERFECT';
                                    setTimeout(() => {
                                        messageOverlay.style.display = 'flex';
                                        messageText.innerHTML = `The perfect item has arrived. <br><br> <a href="https://buiproject.notion.site/projects-by-bui" target="_blank" class="cta-button">Want to know more?</a>`;
                                    }, 2000);
                                }, 4000);
                            }
                            break;
                    }
                    return; // Exit after one click is processed
                }
            }
        }
        
        function restartGame() {
            messageOverlay.style.display = 'none';
            userChoices = { product: null, manufacturer: null };
            gameState = 'CHOOSE_PRODUCT';
            resetAnimation();
        }

        // --- Initialization ---
        canvas.addEventListener('click', handleClick);
        canvas.addEventListener('mousemove', handleMouseMove);
        messageOverlay.addEventListener('click', (e) => {
            if (e.target.tagName !== 'A') {
                restartGame();
            }
        });
        
        gameLoop();
    </script>

</body>
</html>

